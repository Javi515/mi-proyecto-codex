document.addEventListener('DOMContentLoaded',()=>{const body=document.body;const navToggle=document.querySelector('[data-nav-toggle]');const navLinks=document.querySelectorAll('[data-nav-link]');const modal=document.querySelector('[data-modal]');const modalMessage=document.querySelector('[data-modal-message]');const closeModalBtn=document.querySelector('[data-close-modal]');const yearTarget=document.querySelector('[data-current-year]');const reservationForm=document.querySelector('[data-reservation-form]');const filterContainer=document.querySelector('[data-menu-filters]');const menuItems=document.querySelectorAll('[data-menu-item]');const liveRegion=document.querySelector('[data-live-region]');let lastFocusElement=null;const activePage=window.location.pathname.split('/').pop()||'index.html';
const announce=(message)=>{if(liveRegion){liveRegion.textContent='';window.setTimeout(()=>{liveRegion.textContent=message;},50);}else{alert(message);}};const openModal=()=>{if(!modal)return;lastFocusElement=document.activeElement instanceof HTMLElement?document.activeElement:null;modal.setAttribute('aria-hidden','false');modal.removeAttribute('hidden');const focusable=modal.querySelector('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');focusable?.focus();document.addEventListener('keydown',trapEscape);};const closeModal=()=>{if(!modal)return;modal.setAttribute('aria-hidden','true');modal.setAttribute('hidden','');(lastFocusElement||closeModalBtn)?.focus();document.removeEventListener('keydown',trapEscape);};const trapEscape=(event)=>{if(event.key==='Escape'){closeModal();}};
if(yearTarget){yearTarget.textContent=new Date().getFullYear();}
if(navToggle){const toggleNav=(state)=>{const isOpen=state!==undefined?state:!body.classList.contains('nav-open');body.classList.toggle('nav-open',isOpen);navToggle.setAttribute('aria-expanded',body.classList.contains('nav-open'));};navToggle.addEventListener('click',()=>toggleNav());navToggle.addEventListener('keydown',(event)=>{if(event.key==='Enter'||event.key===' '){event.preventDefault();toggleNav();}if(event.key==='Escape'){toggleNav(false);}});document.addEventListener('keydown',(event)=>{if(event.key==='Escape'){toggleNav(false);}});}if(navLinks.length){navLinks.forEach(link=>{const href=link.getAttribute('href');const normalized=href?href.split('/').pop():'index.html';if(normalized===activePage||(normalized==='index.html'&&activePage==='')){link.classList.add('is-active');link.setAttribute('aria-current','page');}link.addEventListener('click',()=>{body.classList.remove('nav-open');navToggle?.setAttribute('aria-expanded','false');});});}
if(filterContainer&&menuItems.length){filterContainer.addEventListener('click',(event)=>{const button=event.target.closest('button[data-filter]');if(!button)return;const filter=button.getAttribute('data-filter');filterContainer.querySelectorAll('button[data-filter]').forEach(btn=>{const isActive=btn===button;btn.classList.toggle('is-active',isActive);btn.setAttribute('aria-pressed',String(isActive));});menuItems.forEach(item=>{const categories=item.getAttribute('data-category')?.split(' ')||[];const show=filter==='all'||categories.includes(filter);item.hidden=!show;item.setAttribute('aria-hidden',String(!show));});});}
if(reservationForm){reservationForm.addEventListener('submit',(event)=>{event.preventDefault();const form=event.target;const formData=new FormData(form);const validators={nombre:value=>value.trim().length>=2||'Por favor, ingresa tu nombre completo.',email:value=>/^\S+@\S+\.\S+$/.test(value)||'Introduce un correo electrónico válido.',telefono:value=>/^\+?[0-9\s-]{7,15}$/.test(value)||'Introduce un teléfono válido.',fecha:value=>!!value||'Selecciona una fecha.',hora:value=>!!value||'Selecciona una hora.',personas:value=>Number(value)>=1||'Indica el número de personas.',preferencias:value=>value.trim().length<=200||'Máximo 200 caracteres.'};let firstErrorField=null;for(const [key,value]of formData.entries()){if(validators[key]){const result=validators[key](value);const field=form.querySelector(`[name="${key}"]`);if(result!==true){field?.setAttribute('aria-invalid','true');if(!firstErrorField){firstErrorField=field;}announce(result);break;}else{field?.removeAttribute('aria-invalid');}}}
if(firstErrorField){firstErrorField.focus({preventScroll:true});return;}const reservationId=Math.random().toString(36).substring(2,8).toUpperCase();if(modal&&modalMessage){modalMessage.innerHTML=`Tu reserva ha sido confirmada. Número de reserva: <strong>${reservationId}</strong>`;openModal();form.reset();}});}if(closeModalBtn){closeModalBtn.addEventListener('click',closeModal);closeModalBtn.addEventListener('keydown',(event)=>{if(event.key==='Enter'||event.key===' '){event.preventDefault();closeModal();}});}modal?.addEventListener('click',(event)=>{if(event.target===modal){closeModal();}});
});
